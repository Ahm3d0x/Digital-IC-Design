<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مساعد تصميم الدوائر الذكي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8fafc; /* gray-50 */
        }
        /* Modal Styles */
        #gemini-modal {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            max-height: 80vh;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Code Block Styles */
        pre[class*="language-"] {
            background: #2d3748; /* gray-800 */
            color: #e2e8f0; /* gray-200 */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            text-align: left;
            direction: ltr;
            font-family: 'Courier New', Courier, monospace;
        }
        /* RTL adjustments for lists inside LTR code blocks */
        .modal-result ul, .modal-result ol {
            text-align: right;
            direction: rtl;
            margin-right: 1.5rem;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

    <!-- Header -->
    <header class="bg-white shadow-md w-full p-6">
        <div class="container mx-auto max-w-6xl text-center">
            <h1 class="text-4xl font-bold text-blue-900">مساعد تصميم الدوائر الذكي</h1>
            <p class="text-lg text-gray-600 mt-2">صندوق أدواتك المدعوم بـ Gemini API لمهام Digital IC Design</p>
        </div>
    </header>

    <!-- Main Content: AI Tools Grid -->
    <main class="container mx-auto max-w-6xl p-6 md:p-10">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            
            <!-- 1. Concept Explainer -->
            <div class="bg-blue-50 p-6 rounded-xl shadow-sm border border-blue-200 flex flex-col">
                <h3 class="font-bold text-xl text-blue-800 mb-3">شرح المفاهيم</h3>
                <p class="text-gray-700 mb-4 flex-grow">اكتب أي مصطلح (مثل "Metastability") واطلب شرحًا مبسطًا.</p>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="concept-input" placeholder="اكتب المفهوم هنا..." class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="concept-btn" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-200 shadow-md">
                        اشرح
                    </button>
                </div>
            </div>

            <!-- 2. Project Suggester -->
            <div class="bg-green-50 p-6 rounded-xl shadow-sm border border-green-200 flex flex-col">
                <h3 class="font-bold text-xl text-green-800 mb-3">اقتراح مشاريع</h3>
                <p class="text-gray-700 mb-4 flex-grow">اطلب فكرة مشروع للمبتدئين لتطبيق ما تعلمته في Verilog.</p>
                <button id="project-btn" class="bg-green-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors duration-200 shadow-md w-full">
                    اقترح مشروع
                </button>
            </div>

            <!-- 3. Interview Question Generator -->
            <div class="bg-yellow-50 p-6 rounded-xl shadow-sm border border-yellow-200 flex flex-col">
                <h3 class="font-bold text-xl text-yellow-800 mb-3">مولد أسئلة المقابلات</h3>
                <p class="text-gray-700 mb-4 flex-grow">استعد للمقابلات بسؤال تقني عشوائي في أحد المواضيع.</p>
                <div class="flex flex-col gap-2">
                    <select id="interview-topic-select" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        <option value="Verilog">Verilog</option>
                        <option value="SystemVerilog">SystemVerilog</option>
                        <option value="UVM">UVM</option>
                        <option value="STA">STA</option>
                        <option value="DFT">DFT</option>
                        <option value="Logic Design">Logic Design</option>
                    </select>
                    <button id="interview-btn" class="bg-yellow-500 text-white font-semibold py-3 px-6 rounded-lg hover:bg-yellow-600 transition-colors duration-200 shadow-md w-full">
                        أنشئ سؤال
                    </button>
                </div>
            </div>

            <!-- 4. Verilog Code Helper -->
            <div class="bg-purple-50 p-6 rounded-xl shadow-sm border border-purple-200 flex flex-col">
                <h3 class="font-bold text-xl text-purple-800 mb-3">مساعد كود Verilog</h3>
                <p class="text-gray-700 mb-4 flex-grow">ألصق كود Verilog واطلب شرحه، اقتراح Testbench، أو إيجاد أخطاء.</p>
                <textarea id="verilog-code-input" rows="6" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 font-mono text-sm" placeholder="module... endmodule"></textarea>
                <div class="flex flex-wrap gap-2 mt-2">
                    <button id="verilog-explain-btn" class="flex-1 bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors duration-200">
                        اشرح
                    </button>
                    <button id="verilog-testbench-btn" class="flex-1 bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors duration-200">
                        اقترح Testbench
                    </button>
                    <button id="verilog-debug-btn" class="flex-1 bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors duration-200">
                        ابحث عن أخطاء
                    </button>
                </div>
            </div>

            <!-- 5. Career Advisor -->
            <div class="bg-pink-50 p-6 rounded-xl shadow-sm border border-pink-200 flex flex-col">
                <h3 class="font-bold text-xl text-pink-800 mb-3">مستشار المسار الوظيفي</h3>
                <p class="text-gray-700 mb-4 flex-grow">اكتب المهارات التي تتقنها (مثل "Verilog, STA") واحصل على اقتراح للأدوار المناسبة.</p>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="career-skills-input" placeholder="اكتب مهاراتك هنا..." class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-500">
                    <button id="career-btn" class="bg-pink-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-pink-700 transition-colors duration-200 shadow-md">
                        انصحني
                    </button>
                </div>
            </div>

            <!-- 6. Comparison Tool -->
            <div class="bg-cyan-50 p-6 rounded-xl shadow-sm border border-cyan-200 flex flex-col">
                <h3 class="font-bold text-xl text-cyan-800 mb-3">أداة المقارنة</h3>
                <p class="text-gray-700 mb-4 flex-grow">قارن بين مفهومين (مثل "ASIC vs FPGA" أو "Blocking vs Non-blocking").</p>
                <div class="flex flex-col gap-2">
                    <input type="text" id="compare-1-input" placeholder="المفهوم الأول" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                    <input type="text" id="compare-2-input" placeholder="المفهوم الثاني" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                </div>
                <button id="compare-btn" class="bg-cyan-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-cyan-700 transition-colors duration-200 shadow-md mt-2 w-full">
                    ✨ قارن
                </button>
            </div>

            <!-- 7. Test Case Generator -->
            <div class="bg-orange-50 p-6 rounded-xl shadow-sm border border-orange-200 flex flex-col">
                <h3 class="font-bold text-xl text-orange-800 mb-3">مولد سيناريوهات الاختبار</h3>
                <p class="text-gray-700 mb-4 flex-grow">صف وحدة (module) (مثل "FIFO" أو "SPI Controller") واحصل على قائمة بـ Test Cases.</p>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="testcase-module-input" placeholder="صف الوحدة (Module)..." class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500">
                    <button id="testcase-btn" class="bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-orange-700 transition-colors duration-200 shadow-md">
                        ✨ اقترح سيناريوهات
                    </button>
                </div>
            </div>

            <!-- 8. Acronym Explainer -->
            <div class="bg-red-50 p-6 rounded-xl shadow-sm border border-red-200 flex flex-col">
                <h3 class="font-bold text-xl text-red-800 mb-3">مفسر الاختصارات (Acronyms)</h3>
                <p class="text-gray-700 mb-4 flex-grow">اكتب أي اختصار (مثل "CDC", "ATPG", "AXI") واحصل على شرحه فورًا.</p>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="acronym-input" placeholder="اكتب الاختصار..." class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                    <button id="acronym-btn" class="bg-red-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-red-700 transition-colors duration-200 shadow-md">
                        ✨ فسّر
                    </button>
                </div>
            </div>

            <!-- 9. Troubleshooter -->
            <div class="bg-gray-100 p-6 rounded-xl shadow-sm border border-gray-300 flex flex-col">
                <h3 class="font-bold text-xl text-gray-800 mb-3">مساعد حل المشكلات</h3>
                <p class="text-gray-700 mb-4 flex-grow">صف مشكلة تواجهك (مثل "المحاكاة لا تعمل") واحصل على أسباب محتملة وخطوات للحل.</p>
                <textarea id="troubleshoot-input" rows="4" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500" placeholder="صِف مشكلتك هنا..."></textarea>
                <button id="troubleshoot-btn" class="bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-gray-700 transition-colors duration-200 shadow-md mt-2 w-full">
                    ✨ ساعدني
                </button>
            </div>

            <!-- 10. Study Planner -->
            <div class="bg-teal-50 p-6 rounded-xl shadow-sm border border-teal-200 flex flex-col">
                <h3 class="font-bold text-xl text-teal-800 mb-3">مخطط التعلم الشخصي</h3>
                <p class="text-gray-700 mb-4 flex-grow">أدخل هدفك ومعرفتك الحالية، واحصل على خطة دراسية لأسبوع.</p>
                <input type="text" id="plan-goal-input" placeholder="الهدف (مثل: فهم STA)" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500 mb-2">
                <input type="text" id="plan-knowledge-input" placeholder="معرفتي الحالية (مثل: أعرف Verilog فقط)" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500">
                <button id="plan-btn" class="bg-teal-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-teal-700 transition-colors duration-200 shadow-md mt-2 w-full">
                    ✨ ضع خطة
                </button>
            </div>
            
            <!-- 11. Code Quality Checker -->
            <div class="bg-emerald-50 p-6 rounded-xl shadow-sm border border-emerald-200 flex flex-col">
                <h3 class="font-bold text-xl text-emerald-800 mb-3">مدقق جودة الكود (Best Practices)</h3>
                <p class="text-gray-700 mb-4 flex-grow">ألصق كود Verilog واحصل على نصائح لتحسين جودته وقابليته للتصنيع.</p>
                <textarea id="quality-code-input" rows="6" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-emerald-500 font-mono text-sm" placeholder="... ألصق كود Verilog هنا ..."></textarea>
                <button id="quality-btn" class="bg-emerald-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-emerald-700 transition-colors duration-200 shadow-md mt-2 w-full">
                    ✨ دقق الجودة
                </button>
            </div>

            <!-- 12. Verilog Code Generator -->
            <div class="bg-fuchsia-50 p-6 rounded-xl shadow-sm border border-fuchsia-200 flex flex-col">
                <h3 class="font-bold text-xl text-fuchsia-800 mb-3">مولد كود Verilog</h3>
                <p class="text-gray-700 mb-4 flex-grow">صف المكون الرقمي الذي تريده (مثل "4-bit counter") واحصل على كود مقترح.</p>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="verilog-gen-input" placeholder="صف المكون هنا..." class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-fuchsia-500">
                    <button id="verilog-gen-btn" class="bg-fuchsia-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-fuchsia-700 transition-colors duration-200 shadow-md">
                        ✨ أنشئ الكود
                    </button>
                </div>
            </div>

            <!-- 13. Design Requirements Analyst -->
            <div class="bg-stone-50 p-6 rounded-xl shadow-sm border border-stone-200 flex flex-col">
                <h3 class="font-bold text-xl text-stone-800 mb-3">محلل متطلبات التصميم</h3>
                <p class="text-gray-700 mb-4 flex-grow">اكتب فكرة تصميم (مثل "a simple ALU") واحصل على قائمة بالمواصفات التي يجب تحديدها.</p>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="req-analyst-input" placeholder="اكتب فكرة التصميم..." class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-stone-500">
                    <button id="req-analyst-btn" class="bg-stone-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-stone-700 transition-colors duration-200 shadow-md">
                        ✨ حلل المتطلبات
                    </button>
                </div>
            </div>

            <!-- 14. Script Generator (TCL/Python) -->
            <div class="bg-indigo-50 p-6 rounded-xl shadow-sm border border-indigo-200 flex flex-col">
                <h3 class="font-bold text-xl text-indigo-800 mb-3">مولد السكربتات (TCL/Python)</h3>
                <p class="text-gray-700 mb-4 flex-grow">صف مهمة أتمتة (مثل "TCL script to read .v files") واحصل على السكربت المقترح.</p>
                <div class="flex flex-col gap-2">
                    <input type="text" id="script-desc-input" placeholder="صف المهمة المطلوبة..." class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <select id="script-lang-select" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="tcl">TCL</option>
                        <option value="python">Python</option>
                        <option value="perl">Perl</option>
                    </select>
                    <button id="script-gen-btn" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-200 shadow-md mt-1 w-full">
                        ✨ أنشئ السكربت
                    </button>
                </div>
            </div>

            <!-- 15. SVA Generator -->
            <div class="bg-lime-50 p-6 rounded-xl shadow-sm border border-lime-200 flex flex-col">
                <h3 class="font-bold text-xl text-lime-800 mb-3">مولد SVA (SystemVerilog Assertions)</h3>
                <p class="text-gray-700 mb-4 flex-grow">صف خاصية (property) للتحقق منها (مثل "req must be followed by gnt") واحصل على كود SVA.</p>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="sva-desc-input" placeholder="صف الخاصية (Property)..." class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-lime-500">
                    <button id="sva-gen-btn" class="bg-lime-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-lime-700 transition-colors duration-200 shadow-md">
                        ✨ أنشئ SVA
                    </button>
                </div>
            </div>

         </div>
    </main>

    <!-- Gemini Modal -->
    <div id="gemini-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden" style="backdrop-filter: blur(5px);">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl modal-content transform transition-all scale-95 opacity-0">
            <div class="flex justify-between items-center p-5 border-b border-gray-200">
                <h3 id="modal-title" class="text-2xl font-bold text-gray-800">جاري التحميل...</h3>
                <button id="modal-close-btn" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <div id="modal-loader" class="flex justify-center items-center h-48">
                    <div class="loader"></div>
                </div>
                <div id="modal-result" class="text-gray-700 text-lg leading-relaxed space-y-4" style="display: none;">
                    <!-- Content will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', function () {
    // --- Gemini API Modal and Logic ---

    const modal = document.getElementById('gemini-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalLoader = document.getElementById('modal-loader');
    const modalResult = document.getElementById('modal-result');
    const modalCloseBtn = document.getElementById('modal-close-btn');

    // Function to open the modal
    function openModal(title) {
        modalTitle.textContent = title;
        modalResult.innerHTML = '';
        modalResult.style.display = 'none';
        modalLoader.style.display = 'flex';
        modal.classList.remove('hidden');
        setTimeout(() => modal.querySelector('.modal-content').classList.add('scale-100', 'opacity-100'), 10);
    }

    // Function to close the modal
    function closeModal() {
        modal.querySelector('.modal-content').classList.remove('scale-100', 'opacity-100');
        setTimeout(() => modal.classList.add('hidden'), 200);
    }

    modalCloseBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeModal();
        }
    });

    // Helper function to convert simple markdown to HTML
    function simpleMarkdownToHTML(text) {
        let html = text
            .replace(/```(verilog|systemverilog|tcl|python|perl)\n([\s\S]*?)```/g, (match, lang, code) => {
                const escapedCode = code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return `<pre class="language-${lang}"><code>${escapedCode}</code></pre>`;
            })
            .replace(/```([\s\S]*?)```/g, (match, code) => {
                const escapedCode = code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return `<pre class="language-none"><code>${escapedCode}</code></pre>`;
            })
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/^(#+)(.*)/gm, (match, hashes, content) => {
                const level = hashes.length;
                return `<h${level + 2} class="font-bold mt-4 mb-2">${content.trim()}</h${level + 2}>`;
            })
            .replace(/^- (.*)/gm, '<li class="mr-4">$1</li>')
            .replace(/(\<li.*\<\/li\>)/g, '<ul>$1</ul>')
            .replace(/\<\/ul\>\n\<ul\>/g, '')
            .replace(/^1\. (.*)/gm, '<li class="mr-4">$1</li>')
            .replace(/(\<li.*\<\/li\>)/g, '<ol>$1</ol>')
            .replace(/\<\/ol\>\n\<ol\>/g, '')
            .replace(/\n/g, '<br>')
            .replace(/<br><br>/g, '</p><p>')
            .replace(/<br><ul>/g, '<ul>')
            .replace(/<\/ul><br>/g, '</ul>')
            .replace(/<br><ol>/g, '<ol>')
            .replace(/<\/ol><br>/g, '</ol>')
            .replace(/<br><h/g, '<h');

        return `<p>${html}</p>`;
    }

    // --- Gemini API Call Function ---
    const apiKey = ""; // سيتم توفير المفتاح تلقائيًا
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

    async function callGeminiAPI(payload, retries = 3, delay = 1000) {
        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                if (response.status === 429 && retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return callGeminiAPI(payload, retries - 1, delay * 2);
                }
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            const candidate = result.candidates?.[0];
            
            if (candidate && candidate.content?.parts?.[0]?.text) {
                return { text: candidate.content.parts[0].text };
            } else {
                return { error: "لم يتم العثور على محتوى في رد الـ API. قد يكون بسبب قيود السلامة." };
            }
        } catch (error) {
            console.error('Error calling Gemini API:', error);
            if (retries > 0) {
                await new Promise(res => setTimeout(res, delay));
                return callGeminiAPI(payload, retries - 1, delay * 2);
            }
            return { error: `فشل الاتصال بـ API: ${error.message}` };
        }
    }

    // --- Event Listeners for Smart Assistant ---

    // 1. Concept Explainer
    const conceptBtn = document.getElementById('concept-btn');
    const conceptInput = document.getElementById('concept-input');
    
    conceptBtn.addEventListener('click', async () => {
        const concept = conceptInput.value.trim();
        if (!concept) {
            alert('الرجاء إدخال مفهوم لشرحه.');
            return;
        }

        openModal(`شرح مفهوم: ${concept}`);
        
        const systemPrompt = "أنت أستاذ جامعي متخصص في هندسة الإلكترونيات، وتشرح المفاهيم لطلابك باللغة العربية. مهمتك هي تبسيط المفاهيم المعقدة في مجال Digital IC Design. استخدم أمثلة بسيطة وتشبيهات إذا أمكن. اجعل الشرح واضحًا وموجزًا.";
        const userQuery = `اشرح لي مفهوم "${concept}" في سياق Digital IC Design.`;
        
        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);
        
        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';
        
        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 2. Project Suggester
    const projectBtn = document.getElementById('project-btn');
    projectBtn.addEventListener('click', async () => {
        openModal("اقتراح مشروع للمبتدئين");

        const systemPrompt = "أنت مرشد مشاريع (Project Mentor) لطلاب هندسة الإلكترونيات. مهمتك هي اقتراح أفكار مشاريع Verilog مناسبة للمبتدئين. يجب أن يتضمن الاقتراح: اسم المشروع، وصف موجز، المهارات الأساسية المطلوبة (مثل FSM, Combinational Logic)، وبعض التحديات أو الميزات الإضافية (Extra Features) التي يمكن للطالب إضافتها. قدم الاقتراح باللغة العربية.";
        const userQuery = "اقترح عليّ فكرة مشروع Verilog مناسبة كمبتدئ لتعلم أساسيات RTL Design.";

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 3. Interview Question Generator
    const interviewBtn = document.getElementById('interview-btn');
    const interviewTopicSelect = document.getElementById('interview-topic-select');

    interviewBtn.addEventListener('click', async () => {
        const topic = interviewTopicSelect.value;
        openModal(`سؤال مقابلة في: ${topic}`);

        const systemPrompt = "أنت مهندس أول (Senior Engineer) تجري مقابلات فنية. مهمتك هي طرح سؤال تقني صعب ومناسب لمقابلة عمل في مجال Digital IC Design حول الموضوع المحدد. يجب أن تقدم السؤال أولاً، ثم تقدم إجابة نموذجية مفصلة. قدم السؤال والإجابة باللغة العربية.";
        const userQuery = `اطرح سؤال مقابلة تقني (Technical Interview Question) وإجابته النموذجية حول موضوع: ${topic}.`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 4. Verilog Code Helper
    const verilogCodeInput = document.getElementById('verilog-code-input');
    const verilogExplainBtn = document.getElementById('verilog-explain-btn');
    const verilogTestbenchBtn = document.getElementById('verilog-testbench-btn');
    const verilogDebugBtn = document.getElementById('verilog-debug-btn');

    async function handleVerilogHelper(task) {
        const code = verilogCodeInput.value.trim();
        if (!code) {
            alert('الرجاء لصق كود Verilog أولاً.');
            return;
        }

        let modalTitle, systemPrompt, userQuery;

        if (task === 'explain') {
            modalTitle = "شرح كود Verilog";
            systemPrompt = "أنت مساعد مبرمج Verilog خبير. مهمتك هي شرح كود Verilog المقدم لك سطراً بسطر أو بلوك ببلوك. وضح وظيفة كل جزء من الكود والغرض من الـ module. قدم الشرح باللغة العربية.";
            userQuery = `اشرح لي كود Verilog التالي: \n\`\`\`verilog\n${code}\n\`\`\``;
        } else if (task === 'testbench') {
            modalTitle = "اقتراح Testbench";
            systemPrompt = "أنت مهندس تحقق (Verification Engineer) خبير. مهمتك هي كتابة كود Testbench أساسي (باستخدام Verilog، وليس SystemVerilog) للكود المقدم. يجب أن يتضمن الـ Testbench: إنشاء إشارات (reg/wire)، عمل instantiate للـ (DUT)، وتوليد clock (إن وجد)، وبعض محفزات الإدخال (stimulus) الأساسية. قم بتضمين الكود داخل ```verilog ... ``` واشرحه باللغة العربية.";
            userQuery = `اقترح لي Testbench أساسي لكود Verilog التالي: \n\`\`\`verilog\n${code}\n\`\`\``;
        } else if (task === 'debug') {
            modalTitle = "البحث عن أخطاء";
            systemPrompt = "أنت مدقق كود (Linting Tool) وخبير في Verilog. مهمتك هي فحص الكود المقدم للبحث عن أخطاء شائعة (common mistakes) أو مشاكل (issues) قد تسبب أخطاء في الـ Simulation أو الـ Synthesis (مثل incomplete sensitivity list, latches, blocking/non-blocking misuse). لا تركز على الأخطاء الوظيفية بل على الأخطاء النمطية (syntactical/structural problems). قدم ملاحظاتك باللغة العربية.";
            userQuery = `افحص كود Verilog التالي وابحث عن أخطاء شائعة أو مشاكل: \n\`\`\`verilog\n${code}\n\`\`\``;
        }

        openModal(modalTitle);

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    }

    verilogExplainBtn.addEventListener('click', () => handleVerilogHelper('explain'));
    verilogTestbenchBtn.addEventListener('click', () => handleVerilogHelper('testbench'));
    verilogDebugBtn.addEventListener('click', () => handleVerilogHelper('debug'));

    // 5. Career Advisor
    const careerBtn = document.getElementById('career-btn');
    const careerSkillsInput = document.getElementById('career-skills-input');

    careerBtn.addEventListener('click', async () => {
        const skills = careerSkillsInput.value.trim();
        if (!skills) {
            alert('الرجاء إدخال مهاراتك أولاً.');
            return;
        }

        openModal("نصيحة للمسار الوظيفي");

        const systemPrompt = "أنت مستشار توظيف خبير (Technical Recruiter) متخصص في مجال VLSI و IC Design. مهمتك هي تحليل المهارات التي يقدمها الطالب، واقتراح أنسب الأدوار الوظيفية له (مثل Design Engineer, Verification Engineer, PnR, DFT). يجب أيضًا أن تقدم له نصيحة واحدة حول أهم مهارة تالية يجب أن يتعلمها ليطور من مساره. قدم الإجابة باللغة العربية.";
        const userQuery = `أنا أتقن المهارات التالية: "${skills}". ما هي الأدوار الوظيفية الأنسب لي، وما هي أهم خطوة تالية أو مهارة يجب أن أتعلمها؟`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 6. Comparison Tool
    const compareBtn = document.getElementById('compare-btn');
    const compare1Input = document.getElementById('compare-1-input');
    const compare2Input = document.getElementById('compare-2-input');

    compareBtn.addEventListener('click', async () => {
        const concept1 = compare1Input.value.trim();
        const concept2 = compare2Input.value.trim();

        if (!concept1 || !concept2) {
            alert('الرجاء إدخال المفهومين للمقارنة.');
            return;
        }

        openModal(`مقارنة بين: ${concept1} و ${concept2}`);

        const systemPrompt = "أنت خبير في Digital IC Design. مهمتك هي تقديم مقارنة واضحة ومفصلة بين المفهومين المقدمين لك. ركز على الفروقات الجوهرية، حالات الاستخدام، والمميزات والعيوب لكل منهما. استخدم جدولاً إذا كان ذلك مناسبًا. قدم المقارنة باللغة العربية.";
        const userQuery = `قم بإجراء مقارنة مفصلة بين "${concept1}" و "${concept2}".`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 7. Test Case Generator
    const testcaseBtn = document.getElementById('testcase-btn');
    const testcaseModuleInput = document.getElementById('testcase-module-input');

    testcaseBtn.addEventListener('click', async () => {
        const moduleDesc = testcaseModuleInput.value.trim();
        if (!moduleDesc) {
            alert('الرجاء وصف الوحدة (Module) أولاً.');
            return;
        }

        openModal(`سيناريوهات اختبار لـ: ${moduleDesc}`);

        const systemPrompt = "أنت مهندس تحقق (Verification Engineer) أول. مهمتك هي إنشاء قائمة بسيناريوهات الاختبار (Test Cases) التي يجب تغطيتها للتحقق من صحة الوحدة (Module) التي وصفها المستخدم. ركز على الحالات الأساسية (Basic cases)، الحالات الحدية (Corner cases)، والحالات الخاطئة (Error cases). قدم القائمة باللغة العربية على شكل نقاط واضحة.";
        const userQuery = `ما هي أهم سيناريوهات الاختبار (Test Cases) التي يجب أن أغطيها لوحدة (Module) تقوم بـ: "${moduleDesc}"؟`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 8. Acronym Explainer
    const acronymBtn = document.getElementById('acronym-btn');
    const acronymInput = document.getElementById('acronym-input');

    acronymBtn.addEventListener('click', async () => {
        const acronym = acronymInput.value.trim();
        if (!acronym) {
            alert('الرجاء إدخال الاختصار.');
            return;
        }

        openModal(`تفسير اختصار: ${acronym}`);

        const systemPrompt = "أنت قاموس متخصص في هندسة VLSI و Digital IC Design. مهمتك هي تقديم المعنى الكامل للاختصار المقدم لك، مع شرح موجز ومبسط لوظيفته أو استخدامه في المجال. قدم الإجابة باللغة العربية.";
        const userQuery = `ما هو معنى اختصار "${acronym}" في مجال IC Design وما هي وظيفته؟`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 9. Troubleshooter
    const troubleshootBtn = document.getElementById('troubleshoot-btn');
    const troubleshootInput = document.getElementById('troubleshoot-input');

    troubleshootBtn.addEventListener('click', async () => {
        const problem = troubleshootInput.value.trim();
        if (!problem) {
            alert('الرجاء وصف المشكلة أولاً.');
            return;
        }

        openModal("مساعد حل المشكلات");

        const systemPrompt = "أنت مهندس دعم فني (Technical Support Engineer) خبير في أدوات ومناهج Digital Design. مهمتك هي مساعدة الطالب على حل مشكلته. قم بتحليل المشكلة التي وصفها، واقترح قائمة من الأسباب المحتملة (Potential Causes) وخطوات عملية (Actionable Steps) لتتبع الخطأ وإصلاحه (Debugging). قدم الإجابة باللغة العربية.";
        const userQuery = `أواجه المشكلة التالية: "${problem}". ما هي الأسباب المحتملة وما هي خطوات الحل المقترحة؟`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });
    
    // 10. Study Planner
    const planBtn = document.getElementById('plan-btn');
    const planGoalInput = document.getElementById('plan-goal-input');
    const planKnowledgeInput = document.getElementById('plan-knowledge-input');

    planBtn.addEventListener('click', async () => {
        const goal = planGoalInput.value.trim();
        const knowledge = planKnowledgeInput.value.trim();

        if (!goal || !knowledge) {
            alert('الرجاء إدخال الهدف والمعرفة الحالية.');
            return;
        }

        openModal(`خطة دراسية لـ: ${goal}`);

        const systemPrompt = "أنت مرشد أكاديمي (Academic Advisor) متخصص في هندسة الإلكترونيات. مهمتك هي إنشاء خطة دراسية مصغرة لمدة 7 أيام لمساعدة الطالب على تحقيق هدفه التعليمي، بناءً على معرفته الحالية. يجب أن تكون الخطة واقعية ومقسمة يوميًا (اليوم 1، اليوم 2...) مع تحديد المواضيع الأساسية لكل يوم ومصادر مقترحة (إن أمكن). قدم الخطة باللغة العربية.";
        const userQuery = `أريد وضع خطة دراسية لمدة 7 أيام. هدفي هو: "${goal}". معرفتي الحالية هي: "${knowledge}".`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 11. Code Quality Checker
    const qualityBtn = document.getElementById('quality-btn');
    const qualityCodeInput = document.getElementById('quality-code-input');

    qualityBtn.addEventListener('click', async () => {
        const code = qualityCodeInput.value.trim();
        if (!code) {
            alert('الرجاء لصق كود Verilog أولاً.');
            return;
        }

        openModal("تدقيق جودة الكود");

        const systemPrompt = "أنت خبير في (Linting) و (Best Practices) لكتابة كود Verilog. مهمتك هي مراجعة الكود المقدم لك والتركيز **فقط** على جودته، وقابليته للقراءة (Readability)، والمشاكل المحتملة عند التصنيع (Synthesis issues) مثل (latches, non-synthesizable constructs)، وأفضل الممارسات (مثل استخدام non-blocking assignments للـ sequential logic). لا تقم بإيجاد أخطاء وظيفية (functional bugs). قدم ملاحظاتك باللغة العربية على شكل نقاط.";
        const userQuery = `راجع كود Verilog التالي من ناحية الجودة (Best Practices) وقابلية التصنيع (Synthesizability)، وليس من ناحية الوظيفة: \n\`\`\`verilog\n${code}\n\`\`\``;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 12. Verilog Code Generator
    const verilogGenBtn = document.getElementById('verilog-gen-btn');
    const verilogGenInput = document.getElementById('verilog-gen-input');
    
    verilogGenBtn.addEventListener('click', async () => {
        const description = verilogGenInput.value.trim();
        if (!description) {
            alert('الرجاء وصف المكون الذي تريد إنشاء كود له.');
            return;
        }

        openModal(`إنشاء كود لـ: ${description}`);

        const systemPrompt = "أنت مهندس تصميم رقمي خبير ومبرمج Verilog. مهمتك هي كتابة كود Verilog واضح وقابل للتصنيع (synthesizable) بناءً على وصف المستخدم. قم بتضمين الكود داخل ```verilog ... ``` وأضف شرحًا موجزًا لوظيفة الكود باللغة العربية. ركز على إنشاء كود صحيح وواضح للمبتدئين.";
        const userQuery = `اكتب لي كود Verilog لـ: "${description}".`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 13. Design Requirements Analyst
    const reqAnalystBtn = document.getElementById('req-analyst-btn');
    const reqAnalystInput = document.getElementById('req-analyst-input');
    
    reqAnalystBtn.addEventListener('click', async () => {
        const idea = reqAnalystInput.value.trim();
        if (!idea) {
            alert('الرجاء إدخال فكرة التصميم أولاً.');
            return;
        }

        openModal(`تحليل متطلبات لـ: ${idea}`);

        const systemPrompt = "أنت مهندس تصميم أول (Principal Design Engineer) وخبير في تحديد مواصفات التصميم. مهمتك هي مساعدة مهندس مبتدئ على تحويل فكرة تصميم عالية المستوى إلى متطلبات (specifications) واضحة. عندما يعطيك الطالب فكرة، قم بالرد بقائمة من الأسئلة أو النقاط الأساسية التي يجب عليه تحديدها (مثل: تردد الكلوك، نوع الريسيت، عرض البيانات، البروتوكولات المستخدمة، حالات خاصة... الخ). قدم الإجابة باللغة العربية على شكل نقاط واضحة (bullet points).";
        const userQuery = `لدي فكرة التصميم التالية: "${idea}". ما هي الأسئلة الرئيسية أو المواصفات التي يجب أن أحددها قبل البدء في كتابة الكود؟`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 14. Script Generator
    const scriptGenBtn = document.getElementById('script-gen-btn');
    const scriptDescInput = document.getElementById('script-desc-input');
    const scriptLangSelect = document.getElementById('script-lang-select');

    scriptGenBtn.addEventListener('click', async () => {
        const description = scriptDescInput.value.trim();
        const lang = scriptLangSelect.value;
        if (!description) {
            alert('الرجاء وصف المهمة المطلوبة للسكربت.');
            return;
        }

        openModal(`إنشاء سكربت ${lang.toUpperCase()}`);

        const systemPrompt = `أنت خبير في أتمتة تصميم الدوائر المتكاملة (IC Design Automation). مهمتك هي كتابة سكربتات (TCL, Python, Perl) بناءً على وصف المستخدم. قم بتضمين الكود داخل \`\`\`${lang} ... \`\`\` وأضف تعليقات (comments) واضحة داخل الكود لشرحه. قدم شرحًا موجزًا لاستخدام السكربت باللغة العربية.`;
        const userQuery = `اكتب لي سكربت بلغة ${lang} يقوم بالمهمة التالية: "${description}".`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

    // 15. SVA Generator
    const svaGenBtn = document.getElementById('sva-gen-btn');
    const svaDescInput = document.getElementById('sva-desc-input');

    svaGenBtn.addEventListener('click', async () => {
        const description = svaDescInput.value.trim();
        if (!description) {
            alert('الرجاء وصف الخاصية (Property) التي تريد التحقق منها.');
            return;
        }

        openModal(`إنشاء SVA لـ: ${description}`);

        const systemPrompt = "أنت خبير في التحقق الرسمي (Formal Verification) و SystemVerilog Assertions (SVA). مهمتك هي تحويل وصف المستخدم لخاصية (property) معينة إلى كود SVA صحيح. قم بتضمين الكود داخل ```systemverilog ... ``` وقدم شرحًا مبسطًا باللغة العربية لكيفية عمل الـ assertion وماذا تتحقق منه.";
        const userQuery = `أريد كتابة SVA property تتحقق من التالي: "${description}".`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        const result = await callGeminiAPI(payload);

        modalLoader.style.display = 'none';
        modalResult.style.display = 'block';

        if (result.text) {
            modalResult.innerHTML = simpleMarkdownToHTML(result.text);
        } else {
            modalResult.textContent = result.error || "حدث خطأ غير متوقع.";
        }
    });

});
</script>

</body>
</html>